# WARNING: this file is auto-generated by 'build_sync_library.py'
# from the original file 'test_libsecret.py'
# DO NOT CHANGE! Change the original file instead.
import pytest
from typing_extensions import override

from key_value.sync.code_gen.stores.libsecret.store import LibsecretStore
from tests.code_gen.stores.base import BaseStoreTests

# Skip all tests if secretstorage is not available or DBus is not available
try:
    import secretstorage

    # Check if DBus is available
    try:
        conn = secretstorage.dbus_init()
        conn.close()
        DBUS_AVAILABLE = True
    except Exception:
        DBUS_AVAILABLE = False
except ImportError:
    DBUS_AVAILABLE = False

pytestmark = pytest.mark.skipif(not DBUS_AVAILABLE, reason="DBus or secretstorage not available")


class TestLibsecretStore(BaseStoreTests):
    @override
    @pytest.fixture
    def store(self) -> LibsecretStore:
        """Create a libsecret store for testing."""
        store = LibsecretStore(collection_name="py-key-value-test")

        # Clean up any existing test data
        store.setup()
        store.destroy()

        return store
